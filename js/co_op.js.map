{"version":3,"sources":["../../js/co_op.js"],"names":[],"mappings":"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","file":"co_op.js","sourcesContent":["var socket;\n\nfunction connectSocket(elem) {\n  if (socket) // Ensure old connections are closed\n    socket.close(1000)\n\n  $(\".row.message\")?.remove();\n\n  socket = new WebSocket(process.env.WS_URL);\n  socket.addEventListener(\"error\", e => {\n    const roomId = $(\"#room_id\");\n    roomId.classList.add(\"active\");\n    roomId.textContent = \"Could not connect to server. (Server may be down)\";\n  });\n}\n\nfunction createPRow(elem, text) {\n  const row = document.createElement(\"div\");\n  row.classList.add(\"row\", \"message\");\n\n  const p = document.createElement(\"p\");\n  p.textContent = text;\n  row.appendChild(p);\n\n  elem.insertAdjacentElement(\"afterend\", row);\n}\n\nfunction findCell(msg) {\n  return $(`[src=\"${msg.item}\"]`, $(`.grid[data-user-id=\"${msg.id}\"]`)).parentElement;\n}\n\nfunction messageHandler(event, elem) {\n  const msg = JSON.parse(event.data);\n\n  switch (msg.type) {\n    case \"room_created\": {\n      $(\"#room_id\").innerHTML = `Created room with ID: <code>${msg.id}</code> (Give this to your teammates!)`;\n      break;\n    }\n\n    case \"room_joined\": {\n      const room_id = msg.id;\n      break;\n    }\n\n    case \"user_joined\": {\n      const newGrid = $(\".grid\").cloneNode(true);\n      newGrid.dataset.userId = msg.id;\n      $(\"main\").appendChild(newGrid);\n      break;\n    }\n\n    case \"user_left\": {\n      $(`.grid[data-user-id=\"${msg.id}\"]`).remove();\n      break;\n    }\n\n    case \"error\": {\n      createPRow(elem, `Error: ${msg.message}`);\n      break;\n    }\n\n    case \"user_primary\": {\n      handlePrimary({ currentTarget: findCell(msg) }, msg.offset);\n      break;\n    }\n\n    case \"user_secondary\": {\n      handleSecondary({ currentTarget: findCell(msg) });\n      break;\n    }\n\n    case \"user_disable\": {\n      handleDisable({ currentTarget: findCell(msg) });\n      break;\n    }\n  }\n}\n\n$(\"#co_op_join\").onsubmit = (event) => {\n  connectSocket(event.target);\n\n  socket.addEventListener(\"open\", () => {\n    socket.send(JSON.stringify({\n      type: \"join_room\",\n      room: $(\"#co_op_join input\").value,\n    }));\n  });\n  socket.addEventListener(\"message\", e => messageHandler(e, event.target));\n\n  return false;\n};\n\n$(\"#co_op_create\").onsubmit = (event) => {\n  connectSocket(event.target);\n\n  let size = parseInt($(\"#co_op_create input\").value);\n  if (!size) {\n    createPRow(event.target, \"Invalid or no size given, using default of 2.\");\n    size = 2;\n  }\n\n  const roomId = $(\"#room_id\");\n  roomId.classList.add(\"active\");\n  roomId.textContent = `Creating room...`;\n\n  socket.addEventListener(\"open\", () => {\n    socket.send(JSON.stringify({\n      type: \"create_room\",\n      size: size,\n    }));\n  });\n  socket.addEventListener(\"message\", e => messageHandler(e, event.target));\n\n  return false;\n};\n\nconst coOpColumnsElem = $(\"#co_op_columns\");\ntry { coOpColumnsElem.value = localStorage.coOpColumns ?? null }\ncatch {}\ncoOpColumnsElem.oninput = event => {\n  const columns = event.target.value;\n  const main = $(\"main\");\n\n  main.style.gridTemplateColumns = columns ? `repeat(${columns}, auto)`: null;\n\n  try { localStorage.coOpColumns = columns }\n  catch {}\n};\ncoOpColumnsElem.oninput({ target: coOpColumnsElem });\n"]}